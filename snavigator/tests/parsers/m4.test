source testutil.tcl


tcltest::test var-1.0 { var write } {
    browse [save_file f.m4 {
var=1
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_GLOB_VAR_DEF;var<>000002.000<>f.m4;2.3<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>var<>gv;2.3<>2.0<>2.3<>{}
}

tcltest::test var-1.1 { var write } {
    browse [save_file f.m4 {
my_var="two"
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_GLOB_VAR_DEF;my_var<>000002.000<>f.m4;2.6<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>my_var<>gv;2.6<>2.0<>2.6<>{}
}

tcltest::test var-1.2 { var write } {
    browse [save_file f.m4 {
my_var=
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_GLOB_VAR_DEF;my_var<>000002.000<>f.m4;2.6<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>my_var<>gv;2.6<>2.0<>2.6<>{}
}

tcltest::test var-2.1 { var write xref } {
    browse_xref [save_file f.m4 {
var=value
}]
} {PAF_CROSS_REF;#<>GLOBAL<>fu<>#<>var<>gv<>w<>000002<>f.m4;<>
}


tcltest::test var-3.0 { var read } {
    # Parser generates only a read xref
    # when a global variable is read.
    browse [save_file f.m4 {
$var
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
}


tcltest::test var-4.0 { var read xref } {
    browse_xref [save_file f.m4 {
$var
}]
} {PAF_CROSS_REF;#<>GLOBAL<>fu<>#<>var<>gv<>r<>000002<>f.m4;<>
}

tcltest::test var-4.1 { not a var read } {
    browse_xref [save_file f.m4 {
\$var
}]
} {}

tcltest::test var-5.0 { var read xref in macro } {
    browse_xref [save_file f.m4 {
AC_DEFUN([MACRO], $var)
}]
} {PAF_CROSS_REF;#<>MACRO<>fu<>#<>var<>gv<>r<>000002<>f.m4;<>
}

tcltest::test var-5.1 { var write xref in macro } {
    browse_xref [save_file f.m4 {
AC_DEFUN([MACRO], var=2)
}]
} {PAF_CROSS_REF;#<>MACRO<>fu<>#<>var<>gv<>w<>000002<>f.m4;<>
}

tcltest::test var-5.2 { var read xref in macro } {
    browse_xref [save_file f.m4 {
AC_DEFUN([MACRO], $var1)
$var2
}]
} {PAF_CROSS_REF;#<>MACRO<>fu<>#<>var1<>gv<>r<>000002<>f.m4;<>
PAF_CROSS_REF;#<>GLOBAL<>fu<>#<>var2<>gv<>r<>000003<>f.m4;<>
}

tcltest::test var-5.3 { var read xref in macro } {
    browse_xref [save_file f.m4 {
AC_DEFUN([MACRO], var1=1)
var2=2
}]
} {PAF_CROSS_REF;#<>MACRO<>fu<>#<>var1<>gv<>w<>000002<>f.m4;<>
PAF_CROSS_REF;#<>GLOBAL<>fu<>#<>var2<>gv<>w<>000003<>f.m4;<>
}




tcltest::test macro-1.0 { macro definition } {
    browse [save_file f.m4 {
AC_DEFUN([MACRO], [])
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_FUNC_DEF;MACRO<>000002.000<>f.m4;2.21<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>MACRO<>fu;2.21<>2.10<>2.15<>{}
}

tcltest::test macro-1.1 { macro definition } {
    browse [save_file f.m4 {
AU_DEFUN([MACRO], [])
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_FUNC_DEF;MACRO<>000002.000<>f.m4;2.21<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>MACRO<>fu;2.21<>2.10<>2.15<>{}
}

tcltest::test macro-1.2 { macro definition } {
    browse [save_file f.m4 {
m4_define([MACRO], [])
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_FUNC_DEF;MACRO<>000002.000<>f.m4;2.22<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>MACRO<>fu;2.22<>2.11<>2.16<>{}
}

tcltest::test macro-1.3 { macro definition } {
    browse [save_file f.m4 {
AC_DEFUN(MACRO, [])
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_FUNC_DEF;MACRO<>000002.000<>f.m4;2.19<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>MACRO<>fu;2.19<>2.9<>2.14<>{}
}

tcltest::test macro-1.4 { macro definition } {
    browse [save_file f.m4 {
AC_DEFUN( MACRO, [])
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_FUNC_DEF;MACRO<>000002.000<>f.m4;2.20<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>MACRO<>fu;2.20<>2.10<>2.15<>{}
}

tcltest::test macro-1.5 { macro definition } {
    browse [save_file f.m4 {
AC_DEFUN( [MACRO], [])
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_FUNC_DEF;MACRO<>000002.000<>f.m4;2.22<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>MACRO<>fu;2.22<>2.11<>2.16<>{}
}

tcltest::test macro-1.6 { macro definition } {
    browse [save_file f.m4 {
AC_DEFUN(MACRO , [])
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_FUNC_DEF;MACRO<>000002.000<>f.m4;2.20<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>MACRO<>fu;2.20<>2.9<>2.14<>{}
}

tcltest::test macro-1.7 { macro definition } {
    browse [save_file f.m4 {
AC_DEFUN([MACRO] , [])
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_FUNC_DEF;MACRO<>000002.000<>f.m4;2.22<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>MACRO<>fu;2.22<>2.10<>2.15<>{}
}

tcltest::test macro-1.8 { macro definition } {
    browse [save_file f.m4 {
AC_DEFUN(	[MACRO], [])
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_FUNC_DEF;MACRO<>000002.000<>f.m4;2.22<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>MACRO<>fu;2.22<>2.11<>2.16<>{}
}

tcltest::test macro-1.9 { macro definition } {
    browse [save_file f.m4 {
AC_DEFUN([MACRO]	, [])
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_FUNC_DEF;MACRO<>000002.000<>f.m4;2.22<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>MACRO<>fu;2.22<>2.10<>2.15<>{}
}

tcltest::test macro-1.10 { macro definition } {
    browse [save_file f.m4 {
AC_DEFUN([MACRO], [
    ANOTHER_MACRO()
])
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_FUNC_DEF;MACRO<>000002.000<>f.m4;4.2<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>MACRO<>fu;4.2<>2.10<>2.15<>{}
}

tcltest::test macro-2.0 { macro invocation } {
    # Parser generates only a call xref
    # when a macro is invoked

    browse [save_file f.m4 {
MACRO()
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
}

tcltest::test macro-2.1 { macro invocation xref } {
    browse_xref [save_file f.m4 {
MACRO()
}]
} {PAF_CROSS_REF;#<>GLOBAL<>fu<>#<>MACRO<>fu<>p<>000002<>f.m4;<>
}

tcltest::test macro-2.2 { macro invocation xref } {
    browse_xref [save_file f.m4 {
AC_DEFUN([MACRO1] , [MACRO2()])
}]
} {PAF_CROSS_REF;#<>MACRO1<>fu<>#<>MACRO2<>fu<>p<>000002<>f.m4;<>
}

tcltest::test macro-2.3 { macro invocation xref } {
    browse_xref [save_file f.m4 {
AC_DEFUN([MACRO1] , [
    MACRO2()
])
}]
} {PAF_CROSS_REF;#<>MACRO1<>fu<>#<>MACRO2<>fu<>p<>000003<>f.m4;<>
}

tcltest::test macro-2.4 { macro invocation xref } {
    browse_xref [save_file f.m4 {
AC_DEFUN([MACRO] , [
    MACRO1()
    MACRO2()
])
}]
} {PAF_CROSS_REF;#<>MACRO<>fu<>#<>MACRO1<>fu<>p<>000003<>f.m4;<>
PAF_CROSS_REF;#<>MACRO<>fu<>#<>MACRO2<>fu<>p<>000004<>f.m4;<>
}


tcltest::test comment-1.0 { comment } {
    browse [save_file f.m4 {
#var=1
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
}

tcltest::test comment-1.1 { comment } {
    browse [save_file f.m4 {
# var=1
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
}

tcltest::test comment-1.2 { comment } {
    browse [save_file f.m4 {
#	var=1
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
}

tcltest::test comment-1.3 { comment } {
    browse [save_file f.m4 {
#AC_DEFUN([MACRO], [])
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
}


tcltest::test comment-2.0 { comment } {
    browse [save_file f.m4 {
dnl var=1
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
}

tcltest::test comment-2.1 { comment } {
    browse [save_file f.m4 {
dnl	var=1
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
}

tcltest::test comment-2.2 { not a comment } {
    browse [save_file f.m4 {
dnlvar=1
}]
} {Status: Parsing: f.m4
PAF_FILE;f.m4;m4<>
PAF_GLOB_VAR_DEF;dnlvar<>000002.000<>f.m4;2.6<>0x0<>{}<>{}<>{}<>{}
PAF_FILE_SYMBOLS;f.m4<>000002.000<>#<>dnlvar<>gv;2.6<>2.0<>2.6<>{}
}

tcltest::test comment-3.0 { comment xref } {
    browse_xref [save_file f.m4 {
dnl TEXT
}] {-r}
} {PAF_COMMENT_DEF;f.m4<>000002.004<>#<>#;TEXT
}

tcltest::test comment-3.1 { comment xref } {
    browse_xref [save_file f.m4 {
  #	my_comment()
}] {-r}
} {PAF_COMMENT_DEF;f.m4<>000002.004<>#<>#;my_comment()
}

tcltest::test comment-3.2 { comment in macro xref } {
    browse_xref [save_file f.m4 {
AC_DEFUN([MACRO] , [
    #Comment
])
}] {-r}
} {PAF_COMMENT_DEF;f.m4<>000003.005<>#<>#;Comment
}


# cleanup
file delete f.m4
file delete xout
::tcltest::cleanupTests
return
